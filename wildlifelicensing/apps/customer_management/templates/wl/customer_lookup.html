{% extends 'wl/base.html' %} {% load static %} {% load django_bootstrap5 %} {% block extra_css %}
  <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.2.0/dist/select2-bootstrap-5-theme.min.css" rel="stylesheet" />
  <link href="{% static 'wl/css/customer_management.css' %}" rel="stylesheet" />
{% endblock %} {% block requirements %}
  require(['js/customer_search', 'js/dash_tables', 'js/logs'], function (customerSearch, dashTables, logs) { customerSearch.init();{% if customer %}
    dashTables({data:{% if dataJSON %}
      {{ dataJSON|safe }}
    {% else %}
      {}
    {% endif %}}); logs.initCommunicationLog({ showLogPopoverSelector: null, showLogEntryModalSelector: '#addLogEntry', logTableSelector: '#communicationsLogTable', logListURL: "{% url 'wl_main:log_list' customer.id %}", addLogEntryURL: "{% url 'wl_main:add_log_entry' customer.id %}" });
  {% endif %}});
{% endblock %} {% block breadcrumbs %}
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <ol class="breadcrumb wl-breadcrumbs">
          <li>
            <a href="{% url 'wl_home' %}">Home</a>
          </li>
          <li class="active">Customer Lookup</li>
        </ol>
      </div>
    </div>
  </div>
{% endblock %} {% block content %}
  <div class="container">
  <div class="row mb-3">
      <div class="col-md-12">
        <h2>Customer Lookup</h2>
        <p>Enter the customer's name or part thereof.</p>
        <form method="get" action="{% url 'wl_customer_management:customer_lookup' %}">
          <div class="form-group">
            <input type="hidden" name="customer" id="searchCustomer" class="form-control" />
          </div>
          <button type="submit" class="btn btn-primary float-end" id="select" disabled="True">View Customer</button>
        </form>
      </div>
    </div>
    {% if customer %}
      <hr />
      <div class="card mb-3" id="applications">
        <div class="card-header" id="applications-heading">
          <h4 class="card-title"><a role="button" data-bs-toggle="collapse" href="#details-collapse" aria-expanded="true" aria-controls="collapseOne"><h4>Customer Details</h4></a></h4>
        </div>
        <div id="details-collapse" class="collapse show" role="tabpanel" aria-labelledby="details-heading">
          <div class="card-body">
            <div class="row my-2">
              <div class="col-md-3">
                <strong>Title:</strong> {{ customer.title }}
              </div>
              <div class="col-md-3">
                <strong>Given name(s):</strong> {{ customer.first_name }}
              </div>
              <div class="col-md-3">
                <strong>Last name:</strong> {{ customer.last_name }}
              </div>
              <div class="col-md-3">
                <strong>Date of Birth:</strong> {{ customer.dob }}
              </div>
            </div>
            <div class="row my-2">
              <div class="col-md-3">
                <strong>Email:</strong> {{ customer.email }}
              </div>
              <div class="col-md-3">
                <strong>Phone:</strong>
                {% if customer.phone_number %}
                  {{ customer.phone_number }}
                {% else %}
                  Not provided
                {% endif %}
              </div>
              <div class="col-md-3">
                <strong>Mobile:</strong>
                {% if customer.mobile_number %}
                  {{ customer.mobile_number }}
                {% else %}
                  Not provided
                {% endif %}
              </div>
              <div class="col-md-3">
                <strong>Fax:</strong>
                {% if customer.fax_number %}
                  {{ customer.fax_number }}
                {% else %}
                  Not provided
                {% endif %}
              </div>
            </div>
            <div class="row">
              <div class="col-md-6">
                <div class="row my-2">
                  <div class="col-md-12">
                    <strong>Character Check:</strong>
                    {% if customer.character_flagged %}
                      Customer has previously discrepancies.
                    {% else %}
                      Customer has no previous discrepancies.
                    {% endif %}
                  </div>
                </div>
                {% if customer.character_flagged and customer.character_comments %}
                  <div class="row my-2">
                    <div class="col-md-12">
                      <strong>Character Comments:</strong>
                      {{ customer.character_comments }}
                    </div>
                  </div>
                {% endif %}
              </div>
            </div>
            <div class="row">
              <div class="col-md-7">
                <div class="row my-2">
                  <div class="col-md-12">
                    <strong>Identification:</strong>
                    {% if not customer.identification2.upload.url %}
                      Not available
                    {% endif %}
                  </div>
                </div>
                {% if customer.identification2.upload.url %}
                  <div class="row my-2">
                    <div class="col-md-12">
                      <img src="/ledger-private/identification/{{ customer.id }}/" width="100%" />
                    </div>
                  </div>
                {% endif %}
              </div>
              <div class="col-md-5">
                <div class="row my-2">
                  {% if customer.is_senior %}
                    <div class="col-md-12">
                      <strong>Senior Card:</strong>
                      {% if not customer.senior_card2.upload.url %} Not available {% endif %}
                    </div>
                  {% endif %}
                </div>
                {% if customer.senior_card2.upload.url %}
                  <div class="row my-2">
                    <div class="col-md-12">
                      <img src="/ledger-private/senior-card/{{ customer.id }}/" width="100%" />
                    </div>
                  </div>
                {% endif %}
              </div>
            </div>
            <div class="row my-2">
              <div class="col-md-12">
                <a target="_blank" href="{{ customer.acc_mgmt_url }}" class="float-end add-link">Edit Customer Details</a>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="card mb-3" id="applications">
        <div class="card-header" id="applications-heading">
          <h4 class="card-title'><a role="button" data-bs-toggle="collapse" href="#profiles-collapse" aria-expanded="true" aria-controls="collapseOne"><h4>Customer Profiles</h4></a></h4>
        </div>
        <div id="profiles-collapse" class="collapse show" role="tabpanel" aria-labelledby="profiles-heading">
          <div class="card-body">
            <a href="{% url 'wl_customer_management:edit_customer_profile' customer.pk %}" class="float-end add-link">Add Profile</a>
            <table class="table table-striped table-bordered">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Postal Address</th>
                  <th>Institution</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                {% for profile in customer.profiles %}
                  <tr>
                    <td>{{ profile.name }}</td>
                    <td>{{ profile.email }}</td>
                    <td>{{ profile.postal_address.display }}</td>
                    <td>{{ profile.institution }}</td>
                    <td>
                      <a href="{% url 'wl_customer_management:edit_customer_profile' customer.pk profile.pk %}">Edit</a>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="card mb-3" id="applications">
        <div class="card-header" id="applications-heading">
          <h4 class="card-title'><a role="button" data-bs-toggle="collapse" href="#applications-collapse" aria-expanded="true" aria-controls="collapseOne"><h4>Applications</h4></a></h4>
        </div>
        <div id="applications-collapse" class="collapse show" role="tabpanel" aria-labelledby="applications-heading">
          <div class="card-body">
            <div class="row filter-panel pad-bottom-md pad-top-s">
              <div id="applications-filter-panel">
                {% block applications_filters %}

                {% endblock %}
              </div>
            </div>
            <table id="applications-table" class="table table-striped table-bordered dataTable"></table>
          </div>
        </div>
      </div>
      <div class="card mb-3" id="licences">
        <div class="card-header" id="licences-heading">
          <h4 class="card-title'><a role="button" data-bs-toggle="collapse" href="#licences-collapse" aria-expanded="true" aria-controls="collapseOne"><h4>Licences</h4></a></h4>
        </div>
        <div id="licences-collapse" class="collapse show" role="tabpanel" aria-labelledby="licences-heading">
          <div class="card-body">
            <div class="row filter-panel pad-bottom-md pad-top-s">
              <div id="licences-filter-panel">
                {% block licences_filters %}

                {% endblock %}
              </div>
            </div>
            <table id="licences-table" class="table table-striped table-bordered dataTable"></table>
          </div>
        </div>
      </div>
      <div class="card mb-3" id="returns">
        <div class="card-header" id="returns-heading">
          <h4 class="card-title'><a role="button" data-bs-toggle="collapse" href="#returns-collapse" aria-expanded="true" aria-controls="collapseOne"><h4>Returns</h4></a></h4>
        </div>
        <div id="returns-collapse" class="collapse show" role="tabpanel" aria-labelledby="returns-heading">
          <div class="card-body">
            <div class="row filter-panel pad-bottom-md pad-top-s">
              <div id="returns-filter-panel">
                {% block returns_filters %}

                {% endblock %}
              </div>
            </div>
            <table id="returns-table" class="table table-striped table-bordered dataTable"></table>
          </div>
        </div>
      </div>
      <div class="card mb-3" id="communicationsLog">
        <div class="card-header" id="communicationsLogHeading">
          <h4 class="card-title'><a role="button" data-bs-toggle="collapse" href="#communicationsLogCollapse" aria-expanded="true" aria-controls="collapseOne"><h4>Communication Log</h4></a></h4>
        </div>
        <div id="communicationsLogCollapse" class="collapse show" role="tabpanel" aria-labelledby="communicationsLogHeading">
          <div class="card-body">
            <a id="addLogEntry" class="float-end add-link">Add Log Entry</a>
            <div class="mt-3">
              <table id="communicationsLogTable" class="table table-striped table-bordered dataTable"></table>
            </div>
          </div>
        </div>
      </div>
    {% endif %}
  </div>
{% endblock %} {% block modals %}
  {% if customer %}
    {% include 'wl/logs_comm_entry_modal.html' %}
  {% endif %}
{% endblock %}
